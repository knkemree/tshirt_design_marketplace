{% extends "base.html" %}
{% load static %}

{% block title %}{{ variant }}{% endblock %}

{% block javascript %}
<script>
  function rasterizeJSON(){
    raterized = JSON.stringify(canvas.toObject());
    // localStorage.setItem('Kanvas', json);
    $('#id_json_data').val(raterized);
  }
</script>

<script>
  function saveCanvasToJSON() {
    const json = JSON.stringify(canvas);
    localStorage.setItem('Kanvas', json);

  }
</script>

<script>
  function loadCanvasFromJSON() {
    const CANVAS = localStorage.getItem('Kanvas');
    canvas.loadFromJSON(CANVAS, () => {
      console.log('CANVAS untar');
      console.log(CANVAS);

      // making sure to render canvas at the end
      canvas.renderAll();

      // and checking if object's "name" is preserved
      console.log('this.canvas.item(0).name');
      console.log(canvas);
    });
  }
</script>

<script>
  $('#loadFromJSON').on('click', function(){
    loadCanvasFromJSON();
  })
</script>

<script>
  $('#saveToLocal').on('click', function(){
    saveCanvasToJSON();
  })
</script>

<script>
  $('#toJson').on('click', function(){
    console.log(JSON.stringify(canvas.getActiveObject().toObject()))
  })
</script>


<script>
  $('#add-text').on('click', function(){
    var text = $('#text-string').val();
    if(text != ''){
      Addtext(text);
      $('#text-string').val('')
    }else{
      alert('Text area empty')
      $('#text-string').val('')
    };

    
  })
</script>



<script>
  $('.cz-thumblist-item').on('click', function(event){
    var place_id = $('.cz-thumblist-item.active').attr('id');
    console.log(place_id);
    $.ajax({ 
    url: "{% url 'essentials:dynamic_canvas' %}",
    data: {
      'product_id': $('#productid').val(),
    },
    dataType: 'json',
    success:  function(data){
      console.log(data);
      $("#drawingArea").css({ top: data[place_id].top });
      $("#drawingArea").css({ left: data[place_id].left });
      $("#drawingArea").css({ width: data[place_id].width });
      $("#drawingArea").css({ height: data[place_id].height });
      $("#canvas-container").css({ height: data[place_id].height });
      $("#canvas-container").css({ width: data[place_id].width });
      h = parseInt(data[place_id].height, 10)
      w = parseInt(data[place_id].width, 10)
      console.log(h)
      canvas.setWidth(w);
      canvas.setHeight(h)
      
      
    },
    });
    
   });
</script>

<script>
  $(document).ready(function(){
    $.ajax({ 
    url: "{% url 'essentials:dynamic_canvas' %}",
    data: {
      'product_id': $('#productid').val(),
    },
    dataType: 'json',
    success: function(data){
      var place_id = $('.cz-thumblist-item:first').attr('id');
      console.log(data[place_id].top); // another sanity check
      $("#drawingArea").css({ top: data[place_id].top });
      $("#drawingArea").css({ left: data[place_id].left });
      $("#drawingArea").css({ width: data[place_id].width });
      $("#drawingArea").css({ height: data[place_id].height });
      $("#canvas-container").css({ height: data[place_id].height });
      $("#canvas-container").css({ width: data[place_id].width });
      h = parseInt(data[place_id].height, 10)
      w = parseInt(data[place_id].width, 10)
      canvas.setWidth(w);
      canvas.setHeight(h)
    }});

    
  });
</script>

<script>
  $('.cz-thumblist-item').on('click', function(event){
    var placement_id = $('.cz-thumblist-item.active').attr('id');
    $( "#id_placement" ).val(placement_id);
  });
</script>

<script>
  $(document).ready(function(){
    // var placement_id = $('.cz-thumblist-item:first').attr('id');
    var placement_id = setTimeout($('.cz-thumblist-item.active').attr('id'),1000);
    $( "#id_placement" ).val(placement_id);
  });
</script>

<script>
  // send ajax request on load printmetodunu saptamak icin
$(document).ready(function(){
  $.ajax({ 
    url: "{% url 'essentials:change_method' %}",
    data: {
      'method_id': $( "#technique" ).val(),
      'place_id':  $('.cz-thumblist-item:first').attr('id'),
      'variant_id': $('input[name=variantid]', '#post-color').val()
    },
    dataType: 'json',
    success: function(data){
      // console.log(data.price_all_included); 
      $('#price').text("$"+data.price_all_included);
    }});
});
</script>

<script>
$( document ).ready(function(e) {
  $( ".cz-preview-item:first" ).addClass('active')
  $( ".cz-thumblist-item:first" ).addClass('active')
});
</script>

<script>
  // active image'i colora boya
$(document).ready(function() {
  var codeOrTexture = $('input[name=hexOrTexture]:checked', '#post-color').val();
  var texture = codeOrTexture.startsWith("/");
  if (texture) {
    document.getElementById("tshirt-div").style.backgroundImage = "url(" + codeOrTexture + ")";
    $(".thumbnail_image").css("background-image", "url(" + codeOrTexture + ")");
   
  } else {
    document.getElementById("tshirt-div").style.backgroundColor = codeOrTexture;
    $(".thumbnail_image").css("background-color", codeOrTexture);
  };
});
</script>

<script>
// yandaki imageler tiklanildiginda fiyati degistir
$('#post-placement').on('click', function(event){
    event.preventDefault();
    var placement_form = $('#post-placement');
    var action = placement_form.attr('action');
    var placement_data = placement_form.serialize();
    
    $.ajax({
        url : '{% url "essentials:change_place" %}', // the endpoint
        data : {
          'place_id': $('.cz-thumblist-item.active').attr('id'),
          'method_id': $( "#technique" ).val(),
          'variant_id': $('input[name=variantid]', '#post-color').val()
        }, // data sent with the post request
        dataType: 'json',
        // handle a successful response
        success : function(data) {
            // console.log(data.price_all_included); 
            $('#price').text("$"+data.price_all_included);
        },       
    });
  });
</script>

<script>
// get technique id on load or on change. add it to the hidden technique input area. technique id will be added to cart session on add to cart submission
$( document ).ready(function() {
    var tech = $( "#technique" ).val();
    $( "#id_technique" ).val(tech);
});

$(document).on('change', '#post-technique',function(e){
   var tech = $( "#technique" ).val();
   $( "#id_technique" ).val(tech);
   $.ajax({ 
    url: "{% url 'essentials:change_method' %}",
    data: {
      'method_id': $( "#technique" ).val(),
      'place_id': $('.cz-thumblist-item:first').attr('id'),
      'variant_id': $('input[name=variantid]', '#post-color').val()
    },
    dataType: 'json',
    success: function(data){
      console.log(data.price_all_included); // another sanity check
      $('#price').text("$"+data.price_all_included);
    }});
})
</script>


<script>
$(document).on('change', '#post-form',function(e){
    e.preventDefault();
    $(document.body).css({'cursor' : 'wait'});
    $.ajax({
        type:'GET',
        url:'{% url "ajaxcolor" %}',
        data:{
            productid:$('#productid').val(),
            size:$('#size').val(),
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
            // action: 'post'
        },
        data_type : 'html',
        success: function (data) {
            $('#appendHere').html(data.rendered_table);
            $(document.body).css({'cursor' : 'default'});
        },
        error: function (data) {
            $(document.body).css({'cursor' : 'default'});
            alert("Got an error! " + data);
        }
    });
});
</script>

<script>
  let canvas = new fabric.Canvas('tshirt-canvas');
  
  var deleteIcon = "data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E";
  var cloneIcon = "data:image/svg+xml,%3C%3Fxml version='1.0' encoding='iso-8859-1'%3F%3E%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 55.699 55.699' width='100px' height='100px' xml:space='preserve'%3E%3Cpath style='fill:%23010002;' d='M51.51,18.001c-0.006-0.085-0.022-0.167-0.05-0.248c-0.012-0.034-0.02-0.067-0.035-0.1 c-0.049-0.106-0.109-0.206-0.194-0.291v-0.001l0,0c0,0-0.001-0.001-0.001-0.002L34.161,0.293c-0.086-0.087-0.188-0.148-0.295-0.197 c-0.027-0.013-0.057-0.02-0.086-0.03c-0.086-0.029-0.174-0.048-0.265-0.053C33.494,0.011,33.475,0,33.453,0H22.177 c-3.678,0-6.669,2.992-6.669,6.67v1.674h-4.663c-3.678,0-6.67,2.992-6.67,6.67V49.03c0,3.678,2.992,6.669,6.67,6.669h22.677 c3.677,0,6.669-2.991,6.669-6.669v-1.675h4.664c3.678,0,6.669-2.991,6.669-6.669V18.069C51.524,18.045,51.512,18.025,51.51,18.001z M34.454,3.414l13.655,13.655h-8.985c-2.575,0-4.67-2.095-4.67-4.67V3.414z M38.191,49.029c0,2.574-2.095,4.669-4.669,4.669H10.845 c-2.575,0-4.67-2.095-4.67-4.669V15.014c0-2.575,2.095-4.67,4.67-4.67h5.663h4.614v10.399c0,3.678,2.991,6.669,6.668,6.669h10.4 v18.942L38.191,49.029L38.191,49.029z M36.777,25.412h-8.986c-2.574,0-4.668-2.094-4.668-4.669v-8.985L36.777,25.412z M44.855,45.355h-4.664V26.412c0-0.023-0.012-0.044-0.014-0.067c-0.006-0.085-0.021-0.167-0.049-0.249 c-0.012-0.033-0.021-0.066-0.036-0.1c-0.048-0.105-0.109-0.205-0.194-0.29l0,0l0,0c0-0.001-0.001-0.002-0.001-0.002L22.829,8.637 c-0.087-0.086-0.188-0.147-0.295-0.196c-0.029-0.013-0.058-0.021-0.088-0.031c-0.086-0.03-0.172-0.048-0.263-0.053 c-0.021-0.002-0.04-0.013-0.062-0.013h-4.614V6.67c0-2.575,2.095-4.67,4.669-4.67h10.277v10.4c0,3.678,2.992,6.67,6.67,6.67h10.399 v21.616C49.524,43.26,47.429,45.355,44.855,45.355z'/%3E%3C/svg%3E%0A"
  
  var deleteImg = document.createElement('img');
  deleteImg.src = deleteIcon;
  // var cloneImg = document.createElement('img');
  // cloneImg.src = cloneIcon;

  fabric.Object.prototype.transparentCorners = true;
  fabric.Object.prototype.cornerColor = '#B2CCFF';
  fabric.Object.prototype.cornerStyle = 'circle';
  fabric.Object.prototype.cornerSize = 10;

  var fonts = ["Graduate",'Bangers','Boogaloo','Caveat','Caveat Brush','Chela One','Cherry Swash','Coiny','Concert One','Creepster','Fredoka One','Germania One','Knewave','Montserrat','Open Sans','Oswald','Permanent Marker','Rammetto One','Shrikhand','Spicy Rice','Vampiro One','Vollkorn','Wendy One'];

  function updateTshirtImage(imageURL){
      // If the user doesn't pick an option of the select, clear the canvas
      if(!imageURL){
          canvas.clear();
      }

      // Create a new image that can be used in Fabric with the URL
      fabric.Image.fromURL(imageURL, function(img) {
          // Define the image as background image of the Canvas
          canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {
              // Scale the image to the canvas size
              scaleX: canvas.width / img.width,
              scaleY: canvas.height / img.height
          });
      });
  }
  
  document.getElementById("id_uploaded_image").addEventListener("change", function(){
      updateTshirtImage(this.value);
  }, false);


  function readURL(input) {
    if (input.files && input.files[0]) {
      var reader = new FileReader();
      
      reader.onload = function(e) {
        // $('#blah').attr('src', e.target.result);
        $('#id_design').val(e.target.result);
      }
      
      reader.readAsDataURL(input.files[0]); // convert to base64 string
    }
  }

  $("#id_uploaded_image").change(function() {
    readURL(this);
  });
  // When the user clicks on upload a custom picture
  document.getElementById('id_uploaded_image').addEventListener("change", function(e){
      var reader = new FileReader();
      
      reader.onload = function (event){
          var imgObj = new Image();
          imgObj.src = event.target.result;
          // When the picture loads, create the image in Fabric.js
          imgObj.onload = function () {
              var img = new fabric.Image(imgObj);

              img.scaleToHeight(100);
              img.scaleToWidth(100);  
              canvas.centerObject(img);
              canvas.add(img);
              canvas.renderAll();
          };
      };

      // If the user selected a picture, load it
      if(e.target.files[0]){
          reader.readAsDataURL(e.target.files[0]);
      }
  }, false);

  // When the user selects a picture that has been added and press the DEL key
  // The object will be removed !
  document.addEventListener("keydown", function(e) {
      var keyCode = e.keyCode;
      if(keyCode == 46){
          console.log("Removing selected element on Fabric.js on DELETE key !");
          canvas.remove(canvas.getActiveObject());
          $("#text-string").val("");
      }
  }, false);

  $('#fill').change(function(){
      var obj = canvas.getActiveObject();

      if(obj){
          // old api
          // obj.setFill($(this).val());
          obj.set("fill", this.value);
      }
      canvasModifiedCallback();
      canvas.renderAll();
      });

  $('#stroke').change(function(){
  var obj = canvas.getActiveObject();

  if(obj){
      // old api
      // obj.setFill($(this).val());
      obj.set("stroke", this.value);
  }
  canvasModifiedCallback();
  canvas.renderAll();
  });

  $('#shadow').change(function(){
  var obj = canvas.getActiveObject();

  if(obj){
      // old api
      // obj.setFill($(this).val());
      // Create shadow object 
      var shadow = new fabric.Shadow({ 
          color: this.value, 
          affectStroke: false,
          
          blur: 5, 
      });
      obj.set("shadow", shadow);
  }
  canvasModifiedCallback();
  canvas.renderAll();

  });

  
  // Add text
  function Addtext(text) {
      var iTextSample = new fabric.IText(text, {
          left: 50,
          top: 50,
          width: 150,
          fontSize: 50,
          fontFamily: 'Times New Roman',
          fill: '#333',
          // lineHeight: 1.1,
          strokeWidth: 4,
          shadow: shadow,
          paintFirst: 'stroke', // stroke behind fill
          // styles: {
          //     0: {
          //     0: { textDecoration: 'underline', fontSize: 80 },
          //     1: { textBackgroundColor: 'red' }
          //     },
          //     1: {
          //     0: { textBackgroundColor: 'rgba(0,255,0,0.5)' },
          //     4: { fontSize: 20 }
          //     }
          // }
          });
      iTextSample.setControlsVisibility({
          mt: false, // middle top disable
          mb: false, // midle bottom
          ml: false, // middle left
          mr: false, // I think you get it
      });
      
      

      canvas.on('text:changed', function(opt) {
          
          var iTextSample = opt.target;
          if ( iTextSample.width >  250) {
                  iTextSample.fontSize *=  250 / ( iTextSample.width + 1);
                  iTextSample.width =  250;
          };
            

        });
      
      canvas.add(iTextSample).setActiveObject(iTextSample);
      canvas.centerObject(iTextSample);
      
  };

  

  fonts.unshift('Times New Roman');
  // Populate the fontFamily select
  var select = document.getElementById("font-family");
      fonts.forEach(function(font) {
      var option = document.createElement('option');
      option.innerHTML = font;
      option.value = font;
      option.style.fontFamily = font;
      select.appendChild(option);
  });
  

  // Apply selected font on change
  document.getElementById('font-family').onchange = function() {
  if (this.value !== 'Times New Roman') {
      loadAndUse(this.value);
      canvasModifiedCallback();
      canvas.requestRenderAll();
  } else {
      canvas.getActiveObject().set("stroke", this.value);
      canvas.requestRenderAll();
  }
  };

  

  function loadAndUse(font) {
  var myfont = new FontFaceObserver(font)
  myfont.load()
      .then(function() {
      // when font is loaded, use it.
      canvas.getActiveObject().set("fontFamily", font);
      canvas.requestRenderAll();
      }).catch(function(e) {
      console.log(e)
      alert("Can't load " + font +". Did you choose the text?");
      });
  };

  function  renderIcon(icon){                            
      return function renderIcon(ctx, left, top, styleOverride, fabricObject) {
      var size = this.cornerSize;
      ctx.save();
      ctx.translate(left, top);
      ctx.rotate(fabric.util.degreesToRadians(fabricObject.angle));
      ctx.drawImage(icon, -size/2, -size/2, size, size);
      ctx.restore();
      }
  }

  fabric.Object.prototype.controls.deleteControl = new fabric.Control({
      x: 0.5,
      y: -0.5,
      // offsetY: -16,
      // offsetX: 16,
      offsetY: 0,
      offsetX: 0,
      cursorStyle: 'pointer',
      mouseUpHandler: deleteObject,
      render: renderIcon(deleteImg),
      cornerSize: 18
  });

  fabric.Object.prototype.controls.clone = new fabric.Control({
      x: -0.5,
      y: -0.5,
      // offsetY: -16,
      // offsetX: -16,
      offsetY: -12,
      offsetX: -12,
      cursorStyle: 'pointer',
      mouseUpHandler: cloneObject,
      render: renderIcon(cloneImg),
      cornerSize: 14
  });

  function deleteObject(eventData, target) {
          var canvas = target.canvas;
              canvas.remove(target);
          canvas.requestRenderAll();
      }

  function cloneObject(eventData, target) {
      var canvas = target.canvas;
      target.clone(function(cloned) {
      cloned.left += 10;
      cloned.top += 10;
      canvas.add(cloned);
      });
  }

  $(document).ready(function() {
  $('#text-font-size').keyup(function() {
      var val = $(this).val();
      if (isNaN(val)) {
      alert('please enter number');
      $(this).val('');
      }
      var activeObject = canvas.getActiveObject();
      activeObject.fontSize = val;
      canvas.renderAll();
  });
  $('#add-text-btn').click(function() {
      if ($('#text-font-size').val()) {
      var txtfontsize = $('#text-font-size').val();
      } else {
      var txtfontsize = 40;
      }
      var message = $('#add-text-value').val();
      var txtfontfamily = $('#font-family').val();
      var new_text = new fabric.IText(message, {
      left: 100,
      top: 100,
      fontSize: txtfontsize,
      lockUniScaling: true,
      fontFamily: txtfontfamily,
      fill: '#000'
      });
      canvas.add(new_text);
      canvas.setActiveObject(new_text);
  });

  canvas.on('object:selected', function(options) {
    console.log('hey')
      if (options.target) {
      $("textarea#add-text-value").val(options.target.text);
      $("#text-font-size").val(options.target.fontSize);
      }
  });

  canvas.on('object:scaling', function(event) {
      if (event.target) {
      $("textarea#add-text-value").val(event.target.text);
      $("#text-font-size").val((event.target.fontSize * event.target.scaleX).toFixed(0));
      }
  });

  canvas.on('object:modified', function(event) {
      if (event.target) {
      event.target.fontSize *= event.target.scaleX;
      event.target.fontSize = event.target.fontSize.toFixed(0);
      event.target.scaleX = 1;
      event.target.scaleY = 1;
      event.target._clearCache();
      $("textarea#add-text-value").val(event.target.text);
      $("#text-font-size").val(event.target.fontSize);
      }
  });
  canvas.on({
			 'object:moving': function(e) {		  	
			    e.target.opacity = 0.5;
			  },
			  'object:modified': function(e) {		  	
			    e.target.opacity = 1;
			  },
			 
			 'selection:cleared':onSelectedCleared
		 });

  });

  
canvas.on('mouse:move', function(e) {
  //turn off selection
  canvas.selection = false;
});
canvas.on('object:removed', function(e) {
  //turn off selection
  canvas.getActiveObject();
  canvas.selection = false;
});

  
  
</script>

<script>
function add_to_cart() {
      canvas.discardActiveObject();
      canvas.renderAll();
      $(document.body).css({'cursor' : 'wait'});
      $( "#addtocartButton" ).addClass('disabled');
      var add_to_cart_form = $('#addtocartform');
      var action = add_to_cart_form.attr('action');
      var method = add_to_cart_form.attr('method');
      var cart_data = add_to_cart_form.serialize();
      $.ajax({
          url : action, // the endpoint
          type : method, // http method
          data : cart_data, // data sent with the post request
          // handle a successful response
          success : function(data) {
              console.log("success"); // another sanity check
              location.href = '/cart/'
              $(document.body).css({'cursor' : 'default'});
          },
          // handle a non-successful response
          error : function(xhr,errmsg,err) {
            $(document.body).css({'cursor' : 'default'});
              $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+errmsg+
                  " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
              console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
          }
      });
  };
</script>

<script>

  $('#addtocartform').on('submit', function(event){
    event.preventDefault();
    console.log("form submitted!"); 
    const json = JSON.stringify(canvas);
    localStorage.setItem('Kanvas', json);
    const CANVAS = localStorage.getItem('Kanvas');
    $('#id_json_data').val(CANVAS);
    // rasterizeJSON();
    setTimeout(add_to_cart(),3000);
    // add_to_cart();
  });

  $( "#addtocartform" ).mouseover(function() {
    canvas.discardActiveObject();
    canvas.renderAll();
  });

  $('#save').on('click', function(event){
    canvas.discardActiveObject();
    canvas.renderAll();
    var node = document.getElementById('tshirt-div');
    domtoimage.toPng(node).then(function (dataUrl) {
        var img = new Image();
        var options = {
        quality: 0.99,
        };
        img.src = dataUrl;
        document.body.appendChild(img);
        $('#id_end_product_img').val(dataUrl) 
    }).catch(function (error) {
      console.error('oops, something went wrong!', error);
    });
    var node2 = document.getElementById('tshirt-canvas');
    canvas.backgroundImage = null;
    canvas.renderAll();
    domtoimage.toPng(node2).then(function (dataUrl) {
        var img1 = new Image();
        var options = {
        quality: 0.99, 
        width: 2000,
        height: 2000,
        };
        img1.src = dataUrl;
        document.body.appendChild(img1);
        $('#id_design').val(dataUrl); 
    }).catch(function (error) {
      console.error('oops, something went wrong!', error);
    });
    var mockup_id = $(".cz-preview-item.active :input").val();
    $('#id_mockup').val(mockup_id)
    alert('Your design saved');
  });

  var canvasModifiedCallback = function() {
    console.log('canvas modified!');
    var dataUrl = canvas.toDataURL();
    $('#id_design').val(dataUrl);
    canvas.renderAll();
    var mockup_id = $(".cz-preview-item.active :input").val();
    $('#id_mockup').val(mockup_id)
    
    var node = document.getElementById('tshirt-div');
    domtoimage.toPng(node).then(function (dataUrl) {
        
        var img = new Image();
        var options = {
        quality: 0.99,
        };
        img.src = dataUrl;
        document.body.appendChild(img);
        $('#id_end_product_img').val(dataUrl) 
        
    }).catch(function (error) {
      console.error('oops, something went wrong!', error);
    });
  };

  canvas.on('object:added', canvasModifiedCallback);
  canvas.on('object:removed', canvasModifiedCallback);
  canvas.on('object:modified', canvasModifiedCallback);
  
  
</script>
{% endblock %}

{% block css %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Bangers&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Boogaloo&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Caveat:wght@700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Caveat+Brush&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Chela+One&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Cherry+Swash:wght@700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Coiny&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Concert+One&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Creepster&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Germania+One&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Graduate&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Knewave&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@800&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Oswald:wght@500&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Rammetto+One&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Shrikhand&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Spicy+Rice&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Vampiro+One&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Vollkorn:wght@600&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Vollkorn:wght@700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Wendy+One&display=swap');
</style>
{% endblock %}

{% block blank %}

<div class="container">
  <div class="row">
    <div class="col">
      <div class="product-detail">
        <div class="cz-product-gallery">
          <div id="tshirt-div" class="cz-preview order-sm-2 box-shadow">
            <!-- active -->
            {% for place in product.placements.all %}
            <div class="cz-preview-item" id="place{{ place.id }}"><img id="tshirt-backgroundpicture" class="cz-image-zoom" src="{{ place.image.url }}" data-zoom="{{ place.image.url }}" alt="Product image">
              <input type="hidden" value="{{ place.id }}">
              <div class="cz-image-zoom-pane"></div>
            </div>
            {% endfor %}
            <!-- <div id="drawingArea" class="drawing-area" style="border: 1px dashed #B2CCFF;" > -->
            <div id="drawingArea" style="position: absolute;z-index: 10;">
              <canvas id="tshirt-canvas" style="border: 1px dashed #B2CCFF;"></canvas>
            </div>
          </div>

          <div class="cz-thumblist order-sm-1">
            <!-- cz-thumblist-item active -->
            <form id="post-placement" method="POST" action="{% url 'essentials:change_place' %}">
              {% csrf_token %}
              {% for place in product.placements.all %}
              <small><span class="badge badge-dark badge-shadow">{{ place }}</span></small> 
              <a class="cz-thumblist-item" href="#place{{place.id}}" id="{{ place.id }}">
                <input type="hidden" value="{{ place.id }}" name="place_id">
                <img data-toggle="tooltip" data-placement="right" title="{{ place }}"  src="{{ place.image.url }}" alt="Product thumb" class="thumbnail_image"><span>hi</span>
              </a>
              {% endfor %}
            </form>
            
            <a class="cz-thumblist-item video-item" href="https://www.youtube.com/watch?v=nrQevwouWn0"><div class="cz-thumblist-item-text"><i class="czi-video"></i>Video</div></a>
          </div>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="row mb-3">
        <h2>{{ product.title }}</h2>
        <h6><a href="{{ product.category.get_absolute_url }}">{{ product.category }}</a></h6>
      </div>

      <div class="row mb-3">
        <div class="mb-3">
          <span id="price" class="h3 font-weight-normal text-accent mr-1">
            <div class="spinner-border" role="status"></div>
          </span>
          <!-- <del class="text-muted font-size-lg mr-3">$17.<small>00</small></del>--><span class="badge badge-danger badge-shadow align-middle mt-n2">Sale</span> 
        </div>
      </div>
    
    
      <!-- Nav tabs -->
      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
          <a href="#attributes1" class="nav-link active" data-toggle="tab" role="button">
            <i class="czi-tag mr-2"></i>
            Product
          </a>
        </li>
        <li class="nav-item">
          <a href="#home1" class="nav-link" data-toggle="tab" role="tab">
            <i class="czi-add-document mr-2"></i>
            Add Text
          </a>
        </li>
        <li class="nav-item">
          <a href="#profile1" class="nav-link" data-toggle="tab" role="tab">
            <i class="czi-image mr-2"></i>
            Upload Image
          </a>
        </li>
      </ul>

      <!-- Tabs content -->
      <div class="tab-content">
        <div class="tab-pane fade show" id="home1" role="tabpanel">
          <div id='texteditor'>
            <div>
              <select id="font-family" class="form-control"></select>
            </div>
            <div class="row my-3">
              <div class="col">
                <label for="fill">Text color:</label>
                <input type="color" list="presetColors" id="fill" class="form-control">
                <datalist id="presetColors">
                    <option value="#ffffff"/>
                    <option value="#000000"/>
                    <option value="#e8e8e8"/>
                    <option value="#BABABA"/>
                    <option value="#989898"/>
                    <option value="#696969"/>
                    <option value="#7c1123"/>
                    <option value="#c70f28"/>
                    <option value="#ed1c24"/>
                    <option value="#f27981"/>
                    <option value="#ffcad0"/>
                    <option value="#e9bdd5"/>
                    <option value="#d072a6"/>
                    <option value="#cd368c"/>
                    <option value="#c52d89"/>
                    <option value="#84175e"/>
                    <option value="#fff2b3"/>
                    <option value="#ffe94d"/>
                    <option value="#ffc829"/>
                    <option value="#ffb18a"/>
                    <option value="#f5873f"/>
                    <option value="#f26522"/>
                    <option value="#bc5500"/>
                    <option value="#e5e43b"/>
                    <option value="#f7c194"/>
                    <option value="#bf854b"/>
                    <option value="#603913"/>
                    <option value="#e7ffd7"/>
                    <option value="#a1c75b"/>
                    <option value="#74b87e"/>
                    <option value="#74a952"/>
                    <option value="#006838"/>
                    <option value="#bfd8c6"/>
                    <option value="#00505a"/>
                    <option value="#ebffff"/>
                    <option value="#a2e5f4"/>
                    <option value="#43b3d4"/>
                    <option value="#3399b5"/>
                    <option value="#6ea5d9"/>
                    <option value="#0e3d84"/>
                    <option value="#0f1e3c"/>
                    <option value="#46276b"/>
                    <option value="#8a6aa7"/>
                    <option value="#b195c2"/>  
                </datalist>
              </div>
              <div class="col">
                  <label for="stroke">Outline</label>
                  <input type="color" list="presetStroke" id="stroke" class="form-control">
                  <datalist id="presetStroke">
                      <option value="#333"/>
                      <option value="#000000"/>
                      <option value="#ffffff"/>
                      <option value="#e8e8e8"/>
                      <option value="#BABABA"/>
                      <option value="#989898"/>
                      <option value="#696969"/>
                      <option value="#7c1123"/>
                      <option value="#c70f28"/>
                      <option value="#ed1c24"/>
                      <option value="#f27981"/>
                      <option value="#ffcad0"/>
                      <option value="#e9bdd5"/>
                      <option value="#d072a6"/>
                      <option value="#cd368c"/>
                      <option value="#c52d89"/>
                      <option value="#84175e"/>
                      <option value="#fff2b3"/>
                      <option value="#ffe94d"/>
                      <option value="#ffc829"/>
                      <option value="#ffb18a"/>
                      <option value="#f5873f"/>
                      <option value="#f26522"/>
                      <option value="#bc5500"/>
                      <option value="#e5e43b"/>
                      <option value="#f7c194"/>
                      <option value="#bf854b"/>
                      <option value="#603913"/>
                      <option value="#e7ffd7"/>
                      <option value="#a1c75b"/>
                      <option value="#74b87e"/>
                      <option value="#74a952"/>
                      <option value="#006838"/>
                      <option value="#bfd8c6"/>
                      <option value="#00505a"/>
                      <option value="#ebffff"/>
                      <option value="#a2e5f4"/>
                      <option value="#43b3d4"/>
                      <option value="#3399b5"/>
                      <option value="#6ea5d9"/>
                      <option value="#0e3d84"/>
                      <option value="#0f1e3c"/>
                      <option value="#46276b"/>
                      <option value="#8a6aa7"/>
                      <option value="#b195c2"/>
                  </datalist>
              </div>
              <div class="col">
                  <label for="shadow">Shadow</label>
                  <input type="color" list="presetStroke" id="shadow" class="form-control">
                  <datalist id="presetStroke"> 
                      <option value="#000000"/>
                      <option value="#ffffff"/>
                      <option value="#e8e8e8"/>
                      <option value="#BABABA"/>
                      <option value="#989898"/>
                      <option value="#696969"/>
                      <option value="#7c1123"/>
                      <option value="#c70f28"/>
                      <option value="#ed1c24"/>
                      <option value="#f27981"/>
                      <option value="#ffcad0"/>
                      <option value="#e9bdd5"/>
                      <option value="#d072a6"/>
                      <option value="#cd368c"/>
                      <option value="#c52d89"/>
                      <option value="#84175e"/>
                      <option value="#fff2b3"/>
                      <option value="#ffe94d"/>
                      <option value="#ffc829"/>
                      <option value="#ffb18a"/>
                      <option value="#f5873f"/>
                      <option value="#f26522"/>
                      <option value="#bc5500"/>
                      <option value="#e5e43b"/>
                      <option value="#f7c194"/>
                      <option value="#bf854b"/>
                      <option value="#603913"/>
                      <option value="#e7ffd7"/>
                      <option value="#a1c75b"/>
                      <option value="#74b87e"/>
                      <option value="#74a952"/>
                      <option value="#006838"/>
                      <option value="#bfd8c6"/>
                      <option value="#00505a"/>
                      <option value="#ebffff"/>
                      <option value="#a2e5f4"/>
                      <option value="#43b3d4"/>
                      <option value="#3399b5"/>
                      <option value="#6ea5d9"/>
                      <option value="#0e3d84"/>
                      <option value="#0f1e3c"/>
                      <option value="#46276b"/>
                      <option value="#8a6aa7"/>
                      <option value="#b195c2"/>
                  </datalist>
              </div>
              <div class="col">
                  
                  <!-- <input type="number" value="4.5" data-decimals="2" min="0" max="9" step="0.1" id="text-size"/> -->
                  <label for="text-font-size">Text Size</label>
                  <input id="text-font-size" data-decimals="2" step="0.1" value="50" type="number" class="form-control">
              </div>
              <div class="col">
                  <label for="letter-spacing">Spacing</label>
                  <input id="letter-spacing" data-decimals="2" step="0.1" value="50" type="number" class="form-control">
              </div>
              
          </div>
          </div>
            
          <textarea class="form-control" id="text-string" name="text" id="" cols="30" rows="5" placeholder="Start typing here..."></textarea>
          <button id="add-text" type="button" class="mt-3 btn btn-primary btn-sm">Add Text</button>
          <!-- <button id='toJson' type="button">Render to Json</button>
          <button id="saveToLocal">Save to local</button>
          <button id='loadFromJSON'>Load from local</button> -->
          <!-- <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Close</button> -->
        </div>
        
        <div class="tab-pane fade" id="profile1" role="tabpanel">
          <!-- Drag and drop file upload -->
          <div class="cz-file-drop-area">
            <div class="cz-file-drop-icon czi-cloud-upload"></div>
            <span class="cz-file-drop-message">Drag and drop here to upload</span>
            <input class="cz-file-drop-input" type="file" name="uploaded_image" accept="image/*" id="id_uploaded_image">
            {% comment %} <input id="tshirt-custompicture" type="file" class="cz-file-drop-input"> {% endcomment %}
            <button type="button" class="cz-file-drop-btn btn btn-primary btn-sm">Or select file</button>
          </div>
          <div>
            <!-- <label for="tshirt-custompicture">Upload your own design:</label>
            <input type="file" id="tshirt-custompicture" class="form-control"/> -->
            <br>
            <label for="tshirt-design">T-Shirt Design:</label>
            <select id="tshirt-design" class="form-control">
                <option value="">Select one of our designs ...</option>
                <option value="https://ourcodeworld.com/public-media/gallery/gallery-5d5b0e95d294c.png">Batman</option>
            </select>
            
          </div>
        </div>
        <div class="tab-pane fade show active" id="attributes1" role="tabpanel">
          <!-- <div class="row mb-3">
            <span class="text-heading font-weight-medium mr-1">Variant:</span><span class="text-muted" id="colorOption">{{ variant.size }} </span> <span class="text-muted" id="colorOption"> / {{ variant.color }}</span>
          </div> -->
            <div class="row mb-3">
            
              <div class="col-md-3 form-group">
              {% comment %} {% for rs in colors %}
                {% if variant.id == rs.id%}
                  {{ rs.color.name}}
                {% endif %}
              {% endfor %}
                {{ color }} {% endcomment %}
                <form method="POST" id="post-technique">
                  <label for="size">Technique:</label>
                  {% csrf_token %}
                  <select class="form-control custom-select" name="technique" id="technique" required>
                    {% for technique in product.methods.all %}
                    <option value="{{ technique.id }}">{{ technique }}</option>
                    {% endfor %}
                  </select>
                </form>
                <form method="POST" id="post-form">
                  <input type="hidden" name="productid" id="productid" value="{{ product.id }}">
                  <label for="size">Size:</label>
                  {% csrf_token %}
                  <select class="form-control custom-select" name="size" id="size" required>
                    {% for rs in sizes %}
                    <option {% if variant.size_id == rs.size_id %} selected {% endif %} value="{{ rs.size_id }}">{{ rs.size }}</option>
                    {% endfor %}
                  </select>
                  <div class="invalid-feedback">Please provide a size.</div>
                  <!-- <div class="valid-feedback">Looks good!</div> -->
                </form>
              </div>
            </div> 
            <div class="row mb-3">
              <div class="col">
                <form method="post" action="?q=selectvariant" id="post-color">
                  {% csrf_token %}
                  <label for="appendHere">Color:</label>
                  <div id="appendHere">
                    <input type="hidden" name="size" id="size" value="{{ size_id }}">
                    {% for rs in colors %}
                      <div class="custom-control custom-option custom-control-inline mb-2">
                          <input type="radio" style="display: none;" name="hexOrTexture" value="{% if rs.color.texture %}{{ rs.color.texture.url }}{% else %}{{ rs.color.color_code }}{% endif %}" {% if variant.id == rs.id %} checked {% endif %}>
                          <input class="custom-control-input" data-label="colorOption" type="radio" name="variantid" id="{{ rs.color.id }}" onchange="this.form.submit();"  value="{{ rs.id }}" {% if variant.id == rs.id %} checked {% endif %}>
                          <label data-toggle="tooltip" data-placement="bottom" title="{{ rs.color.name }}" class="custom-option-label rounded-circle" for="{{ rs.color.id }}"><span class="custom-option-color rounded-circle" style="{% if rs.color.texture %}background-image: url({{ rs.color.texture.url }}){% else %}background-color: {{ rs.color.color_code }}{% endif %}"></span></label>
                      </div>
                    {% endfor %}
                  </div>
                </form>
              </div>
            </div>
            <div class="row mb-3 mt-3">
              <div class="col">
                <form id="addtocartform" action="{% url 'cart:cart_add' variant.id %}" method="POST" enctype="multipart/form-data">
                  {{ cart_product_form.as_p }}
                  {% csrf_token %}
                  <input id='addtocartButton' type="submit" class="btn btn-primary" value="Add to Cart">
                </form>
                <br>
                <!-- <small>Save your design before adding to cart!</small> -->
                <input id='save' type="button" class="btn btn-outline-accent btn-sm"value="Save" style="display: none;"/>
              </div>
            </div>
          </div>
        </div>
        <div class="tab-pane fade" id="settings1" role="tabpanel">
          <p class="font-size-sm">Trust fund seitan letterpress, keytar raw denim keffiyeh etsy art party before they sold out master cleanse gluten-free squid scenester freegan cosby sweater. Fanny pack portland seitan DIY, art party locavore wolf cliche high life echo park Austin. Cred vinyl keffiyeh DIY salvia PBR, banh mi before they sold out farm-to-table VHS viral locavore cosby sweater. Lomo wolf viral, mustache readymade thundercats keffiyeh craft beer marfa ethical. Wolf salvia freegan.</p>
        </div>
      </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
